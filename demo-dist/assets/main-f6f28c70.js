var ht=Object.defineProperty;var lt=(n,t,e)=>t in n?ht(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var h=(n,t,e)=>(lt(n,typeof t!="symbol"?t+"":t,e),e);import{r as g,j as P,_ as T,c as ft,R as pt}from"./preload-helper-d14b839a.js";const tt=g.createContext(null);function et(n){const t=g.useContext(tt);if(t===null)throw TypeError(`Cannot use ${n} outside <RouterView /> scope`);return t}const nt=g.createContext(null);function te(n){const t=g.useContext(nt);if(t===null)throw TypeError(`Cannot use ${n} outside <LookPage /> scope`);return t}const Q=g.createContext(null);Q.displayName="OutletContext";function ee(){return g.useContext(Q)}function dt(){const{router:n}=et("useNavigate");return g.useCallback((t,e={})=>{const{replace:r=!1,state:a,clean:s}=e;if(typeof t=="number"){n.go(t);return}s&&n.clean(),e!=null&&e.switch?n.switch(t,a):r?n.replace(t,a):n.push(t,a)},[n])}function vt(n,t){const{onClick:e,to:r,replace:a=!1,children:s,switch:i=!1,clean:d=!1,...f}=n,{router:c}=et("<Link />"),l=dt();return P.jsx("a",{...f,ref:t,onClick:y=>{y.preventDefault(),y.stopPropagation(),l(r,{replace:a,switch:i,clean:d})},href:c.instance.createHref(r),children:s})}const ne=g.forwardRef(vt);function yt(n){const{visible:t,pathname:e,children:r,noStyle:a}=n,s=g.useRef(null);return P.jsx("div",{ref:s,className:"look-page","data-route":e,style:a?{display:t?void 0:"none"}:{overflow:"auto",height:"100vh",display:t?void 0:"none"},children:r})}function gt(n){return n?Array.isArray(n.children)&&n.children.length>0:!1}const mt=n=>{const{data:t}=n,{route:e,pathname:r,visible:a,children:s}=t,i=e.raw.pageComponent||yt,d=e.raw.component,f=g.useRef(new Set),c=g.useMemo(()=>({instance:t,listenVisible(l){return f.current.add(l),()=>{f.current.delete(l)}}}),[t]);return g.useEffect(()=>{f.current.forEach(l=>l(a))},[a]),P.jsx(nt.Provider,{value:c,children:P.jsx(i,{pathname:r,visible:a,children:gt(e)?P.jsx(Q.Provider,{value:s||null,children:g.createElement(d)}):g.createElement(d)})})};var rt={exports:{}},at={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V=g;function kt(n,t){return n===t&&(n!==0||1/n===1/t)||n!==n&&t!==t}var wt=typeof Object.is=="function"?Object.is:kt,Et=V.useState,St=V.useEffect,Pt=V.useLayoutEffect,xt=V.useDebugValue;function bt(n,t){var e=t(),r=Et({inst:{value:e,getSnapshot:t}}),a=r[0].inst,s=r[1];return Pt(function(){a.value=e,a.getSnapshot=t,F(a)&&s({inst:a})},[n,e,t]),St(function(){return F(a)&&s({inst:a}),n(function(){F(a)&&s({inst:a})})},[n]),xt(e),e}function F(n){var t=n.getSnapshot;n=n.value;try{var e=t();return!wt(n,e)}catch{return!0}}function Rt(n,t){return t()}var Lt=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Rt:bt;at.useSyncExternalStore=V.useSyncExternalStore!==void 0?V.useSyncExternalStore:Lt;rt.exports=at;var At=rt.exports;function _t(n){const t=g.useRef(n);return t.current=n,g.useCallback((...e)=>{var r;return(r=t.current)==null?void 0:r.call(t,...e)},[])}const Ct=n=>{const{router:t,onChange:e,children:r}=n,a=At.useSyncExternalStore(t.stack.addListener,t.stack.getSnapshot),s=g.useMemo(()=>({router:t}),[t]),i=_t(e);return g.useEffect(()=>t.listen((d,f)=>{i==null||i({location:d,route:f})}),[t,i]),P.jsx("div",{className:"look-router-hosts",style:{overflow:"hidden",height:"100vh"},children:P.jsxs(tt.Provider,{value:s,children:[r,a.map(d=>P.jsx(mt,{data:d},d.key))]})})};function H(){return H=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},H.apply(this,arguments)}var b;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(b||(b={}));var q=function(n){return n},z="beforeunload",$t="hashchange",st="popstate";function Tt(n){n===void 0&&(n={});var t=n,e=t.window,r=e===void 0?document.defaultView:e,a=r.history;function s(){var p=r.location,o=p.pathname,u=p.search,v=p.hash,m=a.state||{};return[m.idx,q({pathname:o,search:u,hash:v,state:m.usr||null,key:m.key||"default"})]}var i=null;function d(){if(i)k.call(i),i=null;else{var p=b.Pop,o=s(),u=o[0],v=o[1];if(k.length){if(u!=null){var m=l-u;m&&(i={action:p,location:v,retry:function(){_(m*-1)}},_(m))}}else j(p)}}r.addEventListener(st,d);var f=b.Pop,c=s(),l=c[0],y=c[1],S=W(),k=W();l==null&&(l=0,a.replaceState(H({},a.state,{idx:l}),""));function O(p){return typeof p=="string"?p:U(p)}function A(p,o){return o===void 0&&(o=null),q(H({pathname:y.pathname,hash:"",search:""},typeof p=="string"?G(p):p,{state:o,key:ot()}))}function M(p,o){return[{usr:p.state,key:p.key,idx:o},O(p)]}function D(p,o,u){return!k.length||(k.call({action:p,location:o,retry:u}),!1)}function j(p){f=p;var o=s();l=o[0],y=o[1],S.call({action:f,location:y})}function I(p,o){var u=b.Push,v=A(p,o);function m(){I(p,o)}if(D(u,v,m)){var w=M(v,l+1),E=w[0],x=w[1];try{a.pushState(E,"",x)}catch{r.location.assign(x)}j(u)}}function K(p,o){var u=b.Replace,v=A(p,o);function m(){K(p,o)}if(D(u,v,m)){var w=M(v,l),E=w[0],x=w[1];a.replaceState(E,"",x),j(u)}}function _(p){a.go(p)}var $={get action(){return f},get location(){return y},createHref:O,push:I,replace:K,go:_,back:function(){_(-1)},forward:function(){_(1)},listen:function(o){return S.push(o)},block:function(o){var u=k.push(o);return k.length===1&&r.addEventListener(z,B),function(){u(),k.length||r.removeEventListener(z,B)}}};return $}function Ot(n){n===void 0&&(n={});var t=n,e=t.window,r=e===void 0?document.defaultView:e,a=r.history;function s(){var o=G(r.location.hash.substr(1)),u=o.pathname,v=u===void 0?"/":u,m=o.search,w=m===void 0?"":m,E=o.hash,x=E===void 0?"":E,R=a.state||{};return[R.idx,q({pathname:v,search:w,hash:x,state:R.usr||null,key:R.key||"default"})]}var i=null;function d(){if(i)k.call(i),i=null;else{var o=b.Pop,u=s(),v=u[0],m=u[1];if(k.length){if(v!=null){var w=l-v;w&&(i={action:o,location:m,retry:function(){$(w*-1)}},$(w))}}else I(o)}}r.addEventListener(st,d),r.addEventListener($t,function(){var o=s(),u=o[1];U(u)!==U(y)&&d()});var f=b.Pop,c=s(),l=c[0],y=c[1],S=W(),k=W();l==null&&(l=0,a.replaceState(H({},a.state,{idx:l}),""));function O(){var o=document.querySelector("base"),u="";if(o&&o.getAttribute("href")){var v=r.location.href,m=v.indexOf("#");u=m===-1?v:v.slice(0,m)}return u}function A(o){return O()+"#"+(typeof o=="string"?o:U(o))}function M(o,u){return u===void 0&&(u=null),q(H({pathname:y.pathname,hash:"",search:""},typeof o=="string"?G(o):o,{state:u,key:ot()}))}function D(o,u){return[{usr:o.state,key:o.key,idx:u},A(o)]}function j(o,u,v){return!k.length||(k.call({action:o,location:u,retry:v}),!1)}function I(o){f=o;var u=s();l=u[0],y=u[1],S.call({action:f,location:y})}function K(o,u){var v=b.Push,m=M(o,u);function w(){K(o,u)}if(j(v,m,w)){var E=D(m,l+1),x=E[0],R=E[1];try{a.pushState(x,"",R)}catch{r.location.assign(R)}I(v)}}function _(o,u){var v=b.Replace,m=M(o,u);function w(){_(o,u)}if(j(v,m,w)){var E=D(m,l),x=E[0],R=E[1];a.replaceState(x,"",R),I(v)}}function $(o){a.go(o)}var p={get action(){return f},get location(){return y},createHref:A,push:K,replace:_,go:$,back:function(){$(-1)},forward:function(){$(1)},listen:function(u){return S.push(u)},block:function(u){var v=k.push(u);return k.length===1&&r.addEventListener(z,B),function(){v(),k.length||r.removeEventListener(z,B)}}};return p}function B(n){n.preventDefault(),n.returnValue=""}function W(){var n=[];return{get length(){return n.length},push:function(e){return n.push(e),function(){n=n.filter(function(r){return r!==e})}},call:function(e){n.forEach(function(r){return r&&r(e)})}}}function ot(){return Math.random().toString(36).substr(2,8)}function U(n){var t=n.pathname,e=t===void 0?"/":t,r=n.search,a=r===void 0?"":r,s=n.hash,i=s===void 0?"":s;return a&&a!=="?"&&(e+=a.charAt(0)==="?"?a:"?"+a),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function G(n){var t={};if(n){var e=n.indexOf("#");e>=0&&(t.hash=n.substr(e),n=n.substr(0,e));var r=n.indexOf("?");r>=0&&(t.search=n.substr(r),n=n.substr(0,r)),n&&(t.pathname=n)}return t}function jt(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return console.warn(!1,`The URL path "${n}" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function It(n){const t=[];let e=`^${n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,s,i)=>(t.push({paramName:s,isOptional:i!=null}),i?"/?([^\\/]+)?":"/([^\\/]+)"))}`;return n.endsWith("*")&&(t.push({paramName:"*"}),e+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"),e+="\\/*$",{matcher:new RegExp(e,"i"),compiledParams:t}}const Vt=/^:\w+$/,Ht=3,Mt=2,Dt=1,Kt=10,Nt=-2,X=n=>n==="*";function Ut(n,t){const e=n.split("/");let r=e.length;return e.some(X)&&(r+=Nt),t&&(r+=Mt),e.filter(a=>!X(a)).reduce((a,s)=>{let i=a;return Vt.test(s)?i+=Ht:s===""?i+=Dt:i+=Kt,i},r)}function qt(n){var a;let t=n.slice();const e=[];let r=[];for(;t.length>=1;){const s=t.shift(),{children:i}=s;if(Array.isArray(i)&&i.length>0&&!r.includes(s))r.push(s),t=[...i,s].concat(t);else{const d=r[r.length-1];let f=d==null?void 0:d.path;s===d&&(f=(a=r[r.length-2])==null?void 0:a.path),r.includes(s)&&(r=r.filter(y=>y!==s));const{matcher:c,compiledParams:l}=It(s.path);e.push({...s,raw:s,$$score:Ut(s.path),parent:f,matcher:c,compiledParams:l,match:y=>c.test(y)})}}return e.sort((s,i)=>i.$$score-s.$$score),e}function zt(n,t){let e=-1;for(let r=0;r<n.length;r+=1)t(n[r],r)&&(e=r);return e}class L{constructor(){h(this,"value");h(this,"push",t=>{this.value.push(t)});h(this,"popLast",()=>this.value.pop());h(this,"pop",t=>{const e=zt(this.value,r=>r.pathname===t.pathname&&r.search===t.search);e!==-1&&(this.value.length===e+1?this.popLast():this.value=this.value.slice(0,e+1))});h(this,"has",t=>this.value.findIndex(e=>L.eq(t,e))>-1);h(this,"clean",()=>{this.value=[]});this.value=[]}static eq(t,e){return t.pathname===e.pathname&&t.search===e.search}static encode(t){return`${t.pathname}${t.search}`}get countMap(){const t={};return this.value.forEach(e=>{const r=L.encode(e);let a=t[r];a===void 0&&(a=t[r]={value:e,count:0}),a.count+=1}),t}}function Y(n,t){const e=[],r=t.find(s=>s.match(n));let a=r==null?void 0:r.path;for(;a!==void 0;){const s=t.find(i=>i.path===a);if(s!==void 0)a=s.parent,e.unshift(s);else break}return e}function Z(n,t){if(Array.isArray(n))for(let e=n.length-1;e>=0;e-=1)t(n[e],e)}function Bt(){let n=0;return{new(t){return typeof t=="string"?`${t}`:`globalKey:${++n}`}}}const it=Bt();function ct(n){const{route:t,children:e,parent:r,search:a,pathname:s}=n;if(typeof t!="object"||t===null||!(t!=null&&t.raw.component))throw Error("[look-router]: Route does not exist");const{matcher:i,compiledParams:d}=t,f=s.match(i);let c;if(f){const l=f==null?void 0:f.slice(1);c=d.reduce((y,{paramName:S,isOptional:k},O)=>{const A=l[O];return k&&!A?y[S]=void 0:y[S]=(A||"").replace(/%2F/g,"/"),y},{})}return{visible:!1,key:it.new(),pathname:s,children:e,parent:r,search:a,params:c,route:t}}function Wt(n){const{matches:t,search:e,pathname:r}=n;return ct({route:t[0],search:e,pathname:r})}function Ft(n){const{matches:t,search:e,pathname:r}=n,a=[];let s;const i=()=>{if(Array.isArray(s))return s.slice()},d=f=>{if(Array.isArray(s)){s.push(f);return}s=[f]};return Z(t,f=>{const c=f.match(r),l=ct({route:f,search:e,pathname:c?r:f.path,children:i()});a.unshift(l),d(l)}),Z(a,f=>{f.parent=a.find(c=>c.route.path===f.route.parent)}),a}class N{constructor(){h(this,"stack");h(this,"value");h(this,"setStack",t=>{this.stack=t,this.value=this.stack.filter(e=>e.parent===void 0)});h(this,"find",t=>this.stack.find(e=>N.eq(t,e)));h(this,"findIndex",t=>this.stack.findIndex(t));h(this,"has",t=>this.stack.findIndex(e=>N.eq(t,e))>-1);h(this,"at",t=>{if(t>=-this.stack.length&&t<this.stack.length)return t>=0?this.stack[t]:this.stack[this.stack.length+t]});h(this,"push",(...t)=>{this.setStack([...this.stack,...t])});h(this,"reuse",t=>{const e=this.find(t);return this.setStack(this.stack.slice()),e});h(this,"update",(t,e)=>{this.stack[t]=e});h(this,"visible",t=>{if(this.stack.forEach(e=>{e.visible=!1}),t!==void 0){const e=this.find(t),r=N.getParents(e);e.keepAlive=!1,r.forEach(a=>{a.visible=!0,a.children&&(a.keepAlive=a.children.some(s=>s.keepAlive))})}this.notifyListener()});h(this,"listeners",new Set);h(this,"addListener",t=>(this.listeners.add(t),()=>{this.listeners.delete(t)}));h(this,"getSnapshot",()=>this.value);h(this,"notifyListener",()=>{this.listeners.forEach(t=>t())});this.stack=[],this.value=[]}static create(t){return{...t,visible:t.visible||!1,key:it.new()}}static eq(t,e){return t.key!==void 0&&e.key!==void 0?t.key===e.key:t.pathname===e.pathname&&t.search===e.search}static getParents(t,e=!0){const r=e?[t]:[];let{parent:a}=t;for(;a!==void 0;)r.unshift(a),a=a.parent;return r}}function Gt(n){const t={current:n};return{getState(){return t.current},setState(e){t.current=e},reset(){t.current=n}}}const C=class C{constructor(t){h(this,"instance");h(this,"history",new L);h(this,"stack",new N);h(this,"flattenRoutes");h(this,"routes");h(this,"action",Gt("POP"));h(this,"init",()=>{this.instance.listen(t=>{this.listener.forEach(e=>{this.dispatchListener(t.location,e)}),this.listenImpl(t)}),this.replace(this.instance.location,this.instance.location.state)});h(this,"clean",()=>{this.stack.setStack([]),this.history.clean()});h(this,"push",(t,e)=>{this.action.setState("PUSH"),this.instance.push(t,e)});h(this,"replace",(t,e)=>{this.action.setState("REPLACE"),this.instance.replace(t,e)});h(this,"go",t=>{this.action.setState("POP"),this.instance.go(t)});h(this,"switch",(t,e)=>{this.action.setState("SWITCH"),this.instance.replace(t,e)});h(this,"updateSearch",(t,e,r)=>{const a=this.stack.findIndex(i=>i.key===e);if(a===-1){console.error(`Update search failed, ${t} route not found`);return}const s=this.stack.at(a);s.search=r,this.stack.setStack(this.stack.stack.slice()),this.stack.notifyListener(),this.action.setState("UPDATE_SEARCH"),this.instance.replace({pathname:t,search:r})});h(this,"listenImpl",t=>{const{location:e}=t,r=this.action.getState();if(r==="UPDATE_SEARCH"){this.action.reset();return}const a=jt(e.pathname),s=Y(a,this.flattenRoutes);if(this.action.reset(),s.length===0)throw Error(`${a} does not exist`);const i=s[s.length-1];if(i.raw.redirectTo){const{redirectTo:d}=i.raw;return this.replace(typeof d=="function"?d(e):d)}switch(r){case"PUSH":{this.routerPush(e,s);break}case"REPLACE":{this.routerReplace(e,s);break}case"SWITCH":{this.routerSwitch(e,s);break}default:{this.routerPop(e,s);break}}});h(this,"dispatchListener",(t,e)=>{const r=Y(t.pathname,this.flattenRoutes);e==null||e(t,r[r.length-1].raw)});h(this,"listener",new Set);h(this,"listen",t=>(this.listener.add(t),()=>{this.listener.delete(t)}));h(this,"routerPush",(t,e)=>{const{pathname:r,search:a}=t,s={pathname:r,search:a};if(!Array.isArray(e)||(e==null?void 0:e.length)===0)throw Error("[look-router]: Route does not exist");this.history.push(s),this.stack.has(s)&&this.stack.visible(s);const i=C.renderRoute(t,e);this.stack.setStack(this.diff(this.stack.stack,i)),this.stack.visible(s)});h(this,"routerReplace",(t,e)=>{const{pathname:r,search:a}=t,s={pathname:r,search:a};this.history.popLast(),this.history.push(s);const i=C.renderRoute(t,e),d=this.diff(this.stack.stack,i);this.stack.setStack(d),this.stack.visible(s)});h(this,"routerPop",(t,e)=>{const{pathname:r,search:a}=t;if(!this.history.has({pathname:r,search:a})){this.routerReplace(t,e);return}this.history.pop({pathname:r,search:a});const s=C.renderRoute(t,e),i=this.diff(this.stack.stack,s);this.stack.setStack(i),this.stack.visible({pathname:r,search:a})});h(this,"routerSwitch",(t,e)=>{const{pathname:r,search:a}=t,s={pathname:r,search:a},i=this.history.popLast();this.history.push(s);const d=C.renderRoute(t,e),f=this.diff(this.stack.stack,d,i);this.stack.setStack(f),this.stack.visible(s)});h(this,"diff",(t,e,r)=>{if(t.length===0)return e;const a=C.transformLookStackPageToMap(e),s=(c,l)=>c.filter(y=>y.route.parent===l.route.path),i=[],d=new Set,f=this.history.value.map(c=>L.encode(c));return t.forEach(c=>{if(!c.parent)return;const l=L.encode({pathname:c.pathname,search:c.search||""});f.includes(l)&&d.add(c.parent.key)}),t.forEach(c=>{const l=L.encode({pathname:c.pathname,search:c.search??""}),y=this.history.countMap[l];r&&l===L.encode(r)&&(c.keepAlive=!0),(y||a.has(l)||c.keepAlive||d.has(c.key))&&(c.parent&&d.add(c.parent.key),i.push(c),a.delete(l))}),a.forEach(c=>{i.push(c)}),i.forEach((c,l,y)=>(Array.isArray(c.route.raw.children)&&(c.children=s(y,c),c.children.forEach(S=>{S.parent=c})),c)),i});const{mode:e="hash",routes:r}=t;this.instance=e==="history"?Tt():Ot(),this.routes=r,this.flattenRoutes=qt(r),this.init()}static transformLookStackPageToMap(t){const e=new Map;return t.forEach(r=>{const a=L.encode({pathname:r.pathname,search:r.search??""});e.set(a,r)}),e}};h(C,"renderRoute",(t,e)=>{const{pathname:r,search:a}=t;return e.length>1?Ft({matches:e,search:a,pathname:r}):[Wt({matches:e,search:a,pathname:r})]});let J=C;function Jt(n){const{mode:t="hash",routes:e}=n;return new J({mode:t,routes:e})}const ut=Jt({routes:[{path:"/",redirectTo:"/home",component:g.lazy(()=>T(()=>import("./index-b659d70d.js"),["./index-b659d70d.js","./preload-helper-d14b839a.js"],import.meta.url)),children:[{path:"/home",component:g.lazy(()=>T(()=>import("./home-c6a3cbf0.js"),["./home-c6a3cbf0.js","./preload-helper-d14b839a.js"],import.meta.url)),meta:{title:"首页"}},{path:"/search",component:g.lazy(()=>T(()=>import("./search-6aee2579.js"),["./search-6aee2579.js","./preload-helper-d14b839a.js","./dayjs.min-36c7790a.js"],import.meta.url)),meta:{title:"搜索"}},{path:"/notifications",component:g.lazy(()=>T(()=>import("./notifications-11cc3017.js"),["./notifications-11cc3017.js","./preload-helper-d14b839a.js","./dayjs.min-36c7790a.js"],import.meta.url)),meta:{title:"通知"}},{path:"/messages",component:g.lazy(()=>T(()=>import("./messages-8943da49.js"),["./messages-8943da49.js","./preload-helper-d14b839a.js","./dayjs.min-36c7790a.js"],import.meta.url)),meta:{title:"私信"}}]},{path:"/details/:id",component:g.lazy(()=>T(()=>import("./details-b909a4d1.js"),["./details-b909a4d1.js","./preload-helper-d14b839a.js","./clsx-0839fdbe.js"],import.meta.url)),meta:{title:"详情页"}},{path:"*",component:g.lazy(()=>T(()=>import("./404-5d4f07c1.js"),["./404-5d4f07c1.js","./preload-helper-d14b839a.js"],import.meta.url)),meta:{title:"404"}}]});window.router=ut;const Qt=({route:n})=>{var e;const t=`${((e=n.meta)==null?void 0:e.title)||""}`;document.title=t};ft.createRoot(document.getElementById("root")).render(P.jsx(pt.StrictMode,{children:P.jsx(g.Suspense,{children:P.jsx(Ct,{router:ut,onChange:Qt})})}));export{mt as L,et as a,ne as b,te as c,dt as d,At as s,ee as u};
